# Template de Tarefa - Board do Projeto

> Este arquivo serve como **esqueleto obrigatorio** para qualquer tarefa dentro de `docs/board`.
> O agente **nao pode** criar tarefas fora deste formato.

---

## Identificacao
- **ID da tarefa:** API-012
- **Titulo curto:** Parcelamento: validar mes da parcela com regra de fechamento
- **Status:** DONE
- **Responsavel (agente):** GPT-5 (Codex)
- **Reasoning effort:** High

---

## Contexto
Para compras no cartao, o mes de competencia pode ser diferente do mes da data da transacao. A criacao de parcelas usa a regra de fechamento para decidir em qual arquivo mensal salvar. Na edicao de parcela, a validacao atual exige que o mes da data seja igual ao mes do arquivo, o que impede editar parcelas do cartao quando a data pertence ao mes anterior.

---

## Escopo da Tarefa
### Inclui
- Ajustar a validacao de mes na edicao de parcela para aceitar parcelas de cartao cujo mes de competencia (regra de fechamento) corresponda ao arquivo.
- Manter a validacao atual para parcelas `mode = direct`.
- Usar `creditCard.json` para obter `closingDay` quando `mode = creditCard`.

### Nao inclui (importante)
- Mudancas na geracao de parcelas.
- Alteracoes no modelo JSON.
- Regras de UI ou confirmacao manual.

---

## Regras de Negocio Relacionadas
- ideias.md: 5.1, 5.2, 4.3
- regras-de-negocio.md: 6.1, 6.2, 6.3, 4.3
- modelos-json.md: 4.5

---

## Arquivos Impactados
- `server/data/installments-repository.js`
- `server/data/credit-card-repository.js` (reuso da regra de fechamento)

---

## Passos de Implementacao Esperados
1. Criar uma validacao de competencia da parcela baseada em `mode` e `closingDay`.
2. Substituir a checagem de `parcel.date.slice(0, 7)` por essa validacao na edicao de parcela.
3. Validar com um caso de cartao em que `date` pertence ao mes anterior e `competencia` ao mes do arquivo.

> O agente pode ajustar os passos, mas **nao pode sair do escopo**.

---

## Criterios de Aceite
A tarefa so pode ser movida para **DONE** se **todos** forem verdadeiros:
- [ ] Regra de negocio respeitada
- [ ] Persistencia segue o modelo JSON
- [ ] Nao houve criacao de funcionalidade fora do escopo
- [ ] Fluxo minimo funcional validado manualmente

---

## Como Testar (Manual)
1. Criar um parcelamento no cartao com `firstDate` apos o fechamento (ex.: fechamento 20, data 25).
2. Tentar editar uma parcela do mes de competencia e validar que a edicao eh permitida.
3. Tentar editar uma parcela `mode = direct` com data fora do mes e validar que continua bloqueado.

---

## Pendencias / Observacoes
- Nenhuma.
